<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Econometría</title>
    <meta charset="utf-8" />
    <meta name="author" content="Carlos A. Yanes Guerra" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <script src="libs/xaringanExtra_fit-screen-0.2.6/fit-screen.js"></script>
    <script src="libs/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="libs/shareon-1.4.1/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon-1.4.1/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain-0.2.6/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain-0.2.6/shareagain.js"></script>
    <script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.21/datatables.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="my-css.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">





name: xaringan-title
class: inverse, left, bottom
background-image: url(images/beach1.jpg)
background-size: cover

# **Econometría**
----

## **&lt;br/&gt; Modelos Logísticos (II)**

### Carlos A. Yanes Guerra
### 2023-I



---
class: inverse, middle

# Preguntas... de la sesión anterior? 
&lt;img src="images/lognig.png" width="280" /&gt;

---
layout: true
# Modelo Logit

---

--

#### Qué pasa con todo ese cuento de la regresión?

--

Los métodos de .hi-slayer[regresión] no son buenos cuando se tienen múltiples categorías.

--

Considere que tenemos tres elecciones para ir de un sitio a otro `\((A\rightarrow B)\)` y estos son *Avíon*, *Carro*, *Bus-intermunicipal*. Cómo podríamos entonces manejar eso en una .hi-slayer[regresión] que trabaja con variables numéricas?

--

.left-third[
.center.note[Opción 1]
`$$Y=\begin{cases}
  \displaystyle 1 &amp; \text{si }\color{#e64173}{\text{ Avión}} \\
  \displaystyle 2 &amp; \text{si }\color{#6A5ACD}{\text{ Carro}} \\
  \displaystyle 3 &amp; \text{si }\color{#FFA500}{\text{ Bus}} \\
\end{cases}$$`
]

--

.left-third[
.center.note[Opción 2]
`$$Y=\begin{cases}
  \displaystyle 1 &amp; \text{si }\color{#6A5ACD}{\text{ Carro}} \\
  \displaystyle 2 &amp; \text{si }\color{#e64173}{\text{ Avión}} \\
  \displaystyle 3 &amp; \text{si }\color{#FFA500}{\text{ Bus}} \\
\end{cases}$$`
]

--

.left-third[
.center.note[Opción 3]
`$$Y=\begin{cases}
  \displaystyle 1 &amp; \text{si }\color{#FFA500}{\text{ Bus}} \\
  \displaystyle 2 &amp; \text{si }\color{#e64173}{\text{ Avión}} \\
  \displaystyle 3 &amp; \text{si }\color{#6A5ACD}{\text{ Carro}} \\
\end{cases}$$`
]

--

.hi-pink[Houston!!] we have a problem 🚀. La predicción será muy sensible debido a que no es clara el input de datos y el .hi[orden] de estas puede afectar los .ul[resultados].

---

--

Ahora bien... .hi-purple[resultados binarios] son mas sencillos para la regresión.

--

Si por un momento solo tuvieramos que elegir solo entre las opciones de .pink[Avión] y .purple[Carro]

.left-third[
.center.note[Opción 1]
`$$Y=\begin{cases}
  \displaystyle 0 &amp; \text{si}\color{#e64173}{\text{ Avión}} \\
  \displaystyle 1 &amp; \text{si}\color{#6A5ACD}{\text{ Carro}} \\
\end{cases}$$`
]

.left-thin.center[&lt;br&gt;&lt;br&gt;.center[y]]

.left-third[
.center.note[Opción 2]
`$$Y=\begin{cases}
  \displaystyle 0 &amp; \text{si }\color{#6A5ACD}{\text{ Carro}} \\
  \displaystyle 1 &amp; \text{si }\color{#e64173}{\text{ Avión}} \\
\end{cases}$$`
]

&lt;br/&gt;
.left-full[De alguna manera tenemos el mismo resultado. No termina siendo en realidad un problema.]

---

--

Para los casos de .hi[respuesta binaria], aún se puede hacer un .hi-red[modelo de regresión].

--

Recurde que los estamos definiendo como .attn[Modelos de probabilidad lineal] (MPL).

--

Los resultados/predicciones de él pueden darse como:

1. Estimar la probabilidad condicional `\(y_i = 1\)`, _p.e._, `\(\mathop{\text{Pr}}\left(y_o = 1 \mid x_o\right)\)`

1. Un límite es que pueden salirse del intervalo de `\([0,1]\)`

1. Sin embargo, es bastante útil y fáciles de interpretar.

---

Vamos a usar la base de datos que viene por `Default` del paquete `ISLR`. `\(Y:\text{Variable impago}\)` y para `\(X: \text{Cupo tarjeta crédito}\)`

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-62322b30683bf1b7f530" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-62322b30683bf1b7f530">{"x":{"filter":"none","vertical":false,"data":[["No","No","Yes","No","No","Yes","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","Yes","No","No","No","No","No","No","No","No","No"],["No","Yes","No","No","No","No","No","No","No","No","Yes","No","No","Yes","Yes","No","Yes","No","Yes","No","No","No","No","Yes","Yes","Yes","Yes","Yes","No","Yes","No","No","No","Yes","No","No","No","Yes","No","No","Yes","No","No","Yes","No","No","Yes","No","No","No","No","No","No","No","Yes","No","Yes","No","Yes","No","No","No","No","No","Yes","No","Yes","No","No","No","No","No","No","No","Yes","No","No","No","No","No","Yes","Yes","No","No","Yes","No","Yes","No","No","No","No","Yes","Yes","No","No","No","Yes","No","No","Yes"],[939.098501835431,397.54248845196,1511.61095196469,301.319402807109,878.446109878267,1673.48634915562,310.130223883326,1272.05389130072,887.201436107651,230.868924844914,421.957264818512,1057.35087177407,891.403240954195,1216.58625032905,522.381180598609,1558.86107533,1464.39479015494,740.885186560821,0,1734.22804374841,1155.1750058879,728.356058470814,991.060968479028,640.819040858052,539.834793088502,141.026549625642,1207.05248263756,1288.44855995707,523.708897901411,1182.00008160582,1502.75774867973,131.633998250593,311.889288737823,1200.62447093622,770.431961924154,1177.2495984995,728.212549683954,1941.90292814168,0,674.204629620179,999.391696394237,670.422582334202,350.051851978195,764.627790674236,401.180757478873,751.354391933644,1360.86563270173,497.881905243542,634.696104527899,157.66047507126,0,605.220968306144,1092.99815937252,650.007041287637,492.657068547904,1322.96904167252,1743.79883736231,509.370892230809,1417.22549877778,1189.75213362091,1642.19231860975,1013.96374594514,678.018921587752,522.15345763795,127.663375125104,800.609332848504,2092.4585301161,182.370459994264,1507.24919460052,382.885062371549,768.37858481136,0,934.969703457723,621.312719186294,1384.73759704675,131.747075963338,772.732074090217,364.663051203468,612.960653042669,431.536055178104,847.056485301184,965.587370085486,932.056966292719,779.657300310476,1151.73331728929,368.086167001206,1458.89346152272,202.321208104165,1416.44476989919,615.704276560405,1807.68449070323,840.988909202537,677.552825772912,1073.16853283521,932.872998040885,1088.48809632531,1508.70177606082,1238.10517698086,309.517982126985,1169.42044435962],[45519.0189767343,22710.8657401321,53506.9449260287,51539.9523173009,29561.7830760682,49310.3329074721,37697.2201903282,44895.5933005043,41641.4535720123,32798.7825914845,21744.9742361818,39651.123507722,46611.7316362549,18140.6239934368,23440.0642225885,45255.9671130598,13968.5080055771,34196.067455362,9321.4637343151,37621.6331723075,40398.3993465472,32388.6157596306,37597.3230643757,19055.9165274273,13119.6858549153,11314.3917806231,24747.8899692653,21216.9625737112,48091.7445309658,18102.833748716,53129.7830394396,42028.0085987333,46116.1315257271,18973.9076818191,53398.3147279233,35419.6103097622,50403.5592512078,23467.126966094,33781.6563086993,46481.9526798699,23688.6489687946,53666.1923387936,48411.9866835366,26188.0694950508,39686.6759484968,27179.7616531196,22310.9295094468,55543.6246875475,32594.6922349326,42125.7336109977,24892.9156877399,21792.3215199717,37351.3396590005,41427.8773217528,10154.1562624726,51956.2918282558,17541.0028662017,39546.4726439018,16053.9742636275,50838.5172180485,24444.3121751467,49653.797125496,59416.7788647884,40717.1625219394,13942.2441190945,50324.5549267962,14514.7699586373,45507.9336965974,24057.5179445895,42620.5302295829,43325.9703901599,30360.5489438194,42325.7499854437,39372.0771909379,23083.6670866922,36947.7786180191,47161.2767003098,10239.9724854423,43392.887089339,46941.0589440984,13741.3270672054,16440.0996975194,45505.3072242837,40804.4757033746,23149.5474930787,51601.3608445693,21186.5629553544,37188.5693842123,33099.4968843458,39376.3946187014,42308.9544537047,15406.2074109607,20745.0153256246,51668.9608305471,61192.8971316666,38171.3720733572,25338.2646859801,37544.9421289734,35293.1935706219,19879.2481698692]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>default<\/th>\n      <th>student<\/th>\n      <th>balance<\/th>\n      <th>income<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 0, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>

---
exclude: true



---

.hi-purple[Los datos]: La variable resultado, **default**, toma tan solo dos valores (esto es 3.3% impago).

&lt;img src="Class05_files/figure-html/boxplot-default-balance-1.svg" style="display: block; margin: auto;" /&gt;

---

.hi-purple[Los datos]: La variable resultado, **default**, toma tan solo dos valores (esto es 3.3% impago).


&lt;img src="Class05_files/figure-html/plot-default-points-1.svg" style="display: block; margin: auto;" /&gt;
---

.hi-pink[Modelo de probabilidad lineal] con predicción (la busca el algoritmo)

&lt;img src="Class05_files/figure-html/plot-default-lpm-1.svg" style="display: block; margin: auto;" /&gt;

---

.hi-orange[Regresión Logística] mejora la estimación.

&lt;img src="Class05_files/figure-html/plot-default-logistic-1.svg" style="display: block; margin: auto;" /&gt;

---
layout: false
class: inverse, middle

## Entonces... qué es eso de la regresión logística?
&lt;img src="images/lognig.png" width="280" /&gt;

---
layout: true
# Regresión Logística

---
name: logistic-intro
### Intro

--

.attn[Regresión logística] Modelo de .hi-pink[probabilidad] que permite que los resultados de `\(Y\)` sean estimados (de acuerdo a su característica) y este sea `verdadero(a)`.

--

Por ejemplo:
$$
\begin{align}
  \mathop{\text{Pr}}\left(\text{Default} = \text{Si} | \text{Balance}\right) = p(\text{Balance})
\end{align}
$$

--

Modelamos la probabilidad de caer en `default` (impago) como función de la variable `balance` (viene a ser la relación ingresos-gastos). La idea en realidad viene a ser: *Si un estudiante tiene balance 0, es porque tiene un buen manejo de sus finanzas*. Si en cambio su balance es alto o toma cifras grandes, es porque Gasta mas que lo que tiene de ingresos.  

--

Usamos la probabilidad estimada para hacer **predicciones**
 _p.e._,
- Si `\(p(\text{Balance})\geq 0.5\)`, decimos que ese es el nivel de probabilidad ("si") para NO pagar o ser un individuo irresponsable.
- Siendo conservadores, podríamos decir que la probabilidad de tener un desbalance (gran diferencia entre ingreso y gastos) es de `\(p(\text{Balance})\geq0.1\)`.

---

--

### Que es eso de logístico (Logit)?

--

Deseamos modelar la probabilidad en función de sus predictores `\(\left(\beta_0 + \beta_1 X\right)\)`.

.col-centered[
.hi-pink[Modelo de Probabilidad lineal]
&lt;br&gt;
Predictor .pink[lineal] 

$$
\begin{align}
  p(X) = \beta_0 + \beta_1 X
\end{align}
$$
]

.col-centered[
.hi-orange[Modelo Logístico]
&lt;br&gt;
Transformación de predictores del .orange[logit] 

$$
\begin{align}
  p(X) = \dfrac{e^{\beta_0 + \beta_1 X}}{1 + e^{\beta_0 + \beta_1 X}}
\end{align}
$$
]

---

--

Que es eso de ***función logit*** `\(\left(\frac{e^x}{1+e^x}\right)\)`?

1. Asegura que estemos en el intervalo 0 `\((x\rightarrow-\infty)\)` hasta 1 `\((x\rightarrow\infty)\)`

1. Nos permite tener la curva (s) de nuestra variable no lineal que se ajusta a los datos.

---

--

### Que es eso de logístico?

--

Un poco de matemáticas es:
`$$\begin{align}
  p(X) = \dfrac{e^{\beta_0 + \beta_1 X}}{1 + e^{\beta_0 + \beta_1 X}} \implies \color{#e64173}{\log \left( \dfrac{p(X)}{1-p(X)}\right)} = \color{#6A5ACD}{\beta_0 + \beta_1 X}
\end{align}$$`

Recuerde que la .note[definición] de los .hi-pink[log odds]: son conocidos como los verdaderos .hi[logit]. Si este valor es mayor a (1), nos indica que su relación es mas fuerte con respeto a la variable resultado.

--

1. Tenemos `\(\beta_j\)` como la razón de probabilidad de .pink[log odds]

--

1. .hi-pink[Cambios en probabilidad] debido a `\(X\)` dependen del nivel de `\(X\)`.


---

--

### Estimación

--

Antes de empezar a predecir necesitamos de los `\(\beta_j\)`s.
`$$\begin{align}
  p(X) = \dfrac{e^{\beta_0 + \beta_1 X}}{1 + e^{\beta_0 + \beta_1 X}} \implies \color{#e64173}{\log \left( \dfrac{p(X)}{1-p(X)}\right)} = \color{#6A5ACD}{\beta_0 + \beta_1 X}
\end{align}$$`

--

Estimamos la regresión usando el método de .attn[máxima verosimilitud].

--

.attn[Maximum likelihood estimation] (MLE) busca que los `\(\beta_j\)`s obtenidos sean los "mejores" dada la estimación propuesta.

---

--

### Maximum likelihood

--

.attn[MLE] busca que los `\(\beta_j\)`s obtenidos sean los "mejores" dada la estimación propuesta.

--

`$$\begin{align}
  \color{#e64173}{\log \left( \dfrac{p(X)}{1-p(X)}\right)} = \color{#6A5ACD}{\beta_0 + \beta_1 X}
\end{align}$$`

--

1. `\(\color{#6A5ACD}{\beta_j}\)` nos dice como `\(x_j\)` afecta a los .pink[log odds]

--

1. odds `\(= \dfrac{p(X)}{1-p(X)}\)`.
--
 si `\(p(X) &gt; 0.5\)`, entonces el ratio es `\(&gt;1\)` y .pink[log odds] `\(&gt; 0\)`.

--

Queremos escoger `\(\color{#6A5ACD}{\beta_j}\)` tal que
- .pink[log odds] son superiores a cero para las observaciones en las que `\(y_i=1\)`
- .pink[log odds] serán aún mayores para las zonas de `\(x_j\)` donde la observación `\(i\)`s nos brinda `\(y_i=1\)`

---

--

### Un poco más de la formalidad

La regresión logística o .attn[the likelihood function] nos permite manejar el comportamiento categórico. De alguna manera todo lo hace mejor con los estimadores.


`$$\begin{align}
  \mathop{\ell}(\beta_0,\beta_1) = \prod_{i:y_i=1} \mathop{p}(x_i) \prod_{i:y_i=0} (1-\mathop{p}(x_i))
\end{align}$$`

La función de probabilidad se maximiza 
- Haciendo la `\(p(x_i)\)` mas grande para individuos con `\(y_i = 1\)`
- Haciendo la `\(p(x_i)\)` mas pequeña para individuos con `\(y_i = 0\)`

*Mas simple*: La máxima verosimilitud, maximiza un rendimiento predictivo, condicionado al modelo que hemos establecido.

---

--

### Con el modelo PROBIT

--

Es un algoritmo "hermano" del .hi[logit]. No varian ni siquiera mucho sus resultados, solo que se asume que el residuo `\(e\sim N(0, \sigma^2)\)`.

--

El modelo .hi-purple[Probit] usa la **función acumulada de distribución** de la distribución normal `\(\Phi\)` para especificar la probabilidad y usar la parte de `\(0\leq \Phi \leq 1\)`.

--

`$$\tag{1}
\begin{align}
  p(X) = \Phi(\beta_0 + \beta_1 x_1) \implies \color{#e64173}{\int_{-\infty}^{\beta_0+\beta_1x_1}} \; \frac{1}{\sqrt{2\pi}}e^{-\frac{z^2}{2}}dz 
\end{align}$$`

--

Ahora .hi[ML] busca encontrar los estimadores `\(\beta's\)` 

--

`$$\tag{2}
\begin{align}
\widehat{\beta}= \text{argmax}\; \text{log} \left(\prod_i^n f_i\right)= \sum_i^n\; \text{log}(f_i)
\end{align}$$`

---

--

### Con el modelo PROBIT

--

Tomamos la ecuación (2) y proponemos la aplicación de la propiedad de logaritmo y entonces tenemos:

--

`$$\tag{3}
\begin{align}
\sum_i^n\; \text{log} \left( p_i^{y_i}(1-p_i)^{1-y_i} \right)
\end{align}$$`

--

Solo nos queda bajar los exponentes 😅

--

`$$\tag{4}
\begin{align}
\sum_i^n\; \text{log} \left[ \color{#ffa500}{y_i} log(p_i)+\color{#ffa500}{1-y_i}log(1-p_i) \right]
\end{align}$$`

---

--

### Derivación del Probit

--

.ex[Ejemplo:] Votante 🫣

--

<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M467.14 44.84c-62.55-62.48-161.67-64.78-252.28 25.73-78.61 78.52-60.98 60.92-85.75 85.66-60.46 60.39-70.39 150.83-63.64 211.17l178.44-178.25c6.26-6.25 16.4-6.25 22.65 0s6.25 16.38 0 22.63L7.04 471.03c-9.38 9.37-9.38 24.57 0 33.94 9.38 9.37 24.6 9.37 33.98 0l66.1-66.03C159.42 454.65 279 457.11 353.95 384h-98.19l147.57-49.14c49.99-49.93 36.38-36.18 46.31-46.86h-97.78l131.54-43.8c45.44-74.46 34.31-148.84-16.26-199.36z"/></svg> Suponga que una persona que vota le da cierto "score" o puntaje a cierto candidato presidencial. Este depende del género del votante, edad, educación, etc. El puntaje (score) no se observa, por ende le denominamos **variable latente**. Una persona vota por Petro, `\(y=1\)`, si y solo si el score esta por *encima* de cierto umbral.

--
.pad-left[
`\((\text{y}_{i}=1) = P(Score&gt;0)  \tag{5}\)`
]

--
.pad-left[
`\(= P(x\beta+u&gt;0)\)`
]

--
.pad-left[
`\(= P(u&gt;-x\beta)\)`
]

--
.pad-left[
`\(= P(u&lt;x\beta)\)`
]

--
.pad-left[
`\(=\Phi(x\beta)\)` .pink[✔]
]

---

--

### Por ende el modelo Probit

--

`$$\begin{align}
  \mathop{\text{Pr}}(Y=1|X_1,X_2)= \Phi(\beta_0+\beta_1X_1+\beta_2X_2)
\end{align}$$`

--

Suponga que los betas fueron obtenidos y la variable `\(X_1=0.4\)` y la variable `\(X_2=1\)`, entonces la probabilidad de que ocurra lo anterior es:

--

`$$\begin{align}
  \mathop{\text{Pr}}(Y=1|X_1,X_2)= \Phi(-1.6+2\color{#e64173}{(0.4)}+0.5\color{#6A5ACD}{(1)})
\end{align}$$`

--

`$$\begin{align}
\text{valor z}=-1.6+2\color{#e64173}{(0.4)}+0.5\color{#6A5ACD}{(1)}=-0.3
\end{align}$$`

--

.attn[Busca ese valor en la tabla de la normal y encontrará que la probabilidad es de 38%]

---

--

#### En <svg aria-hidden="true" role="img" viewBox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:steelblue;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg>

Lo hacemos con la función `glm()`.

Ademas: `logistic_reg()` en el paquete `tidymodels` galaxy (tiene el motor `"glm"`).

--

.note[Un punto:] lo de `lm` a `glm` hace referencia al método *generalizado* de momentos o (modelo lineal).

--

"Generalizado" significa esencialmente que estamos aplicando alguna transformación a `\(\beta_0 + \beta_1 X\)` como la regresión logística aplica la función logística.

Algo como: `$$\color{#FFA500}{\mathbf{y}} = \color{#20B2AA}{g}^{-1} \left( \color{#6A5ACD}{\mathbf{X}} \color{#e64173}{\beta} \right) \iff \color{#20B2AA}{g}(\color{#FFA500}{\mathbf{y}}) = \color{#6A5ACD}{\mathbf{X}} \color{#e64173}{\beta}$$`

---

--

Los argumentos de `glm()` son muy similares

.blue[Clave usar] (`lm()`)

- Se especifica la `formula`,.super[.pink[♠︎]] _p.e._, `y ~ .` o `y ~ x + I(x^2)`

- Se define `family = "binomial"` (Ya el mismo R lo identifica)

- Dado el grupo de `datos`

.footnote[
.pink[♠] Siempre estamos en la parte de selección de un modelo
]

---

--

## En <svg aria-hidden="true" role="img" viewBox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:steelblue;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> el modelo debe establecerse como:

--

Tomemos a consideración el desarrollo del modelo


```r
est_logistic = glm(
  i_default ~ balance,
* family = "binomial",
  data = default_df
)
```

--

Adicional para esto es:

```r
probit &lt;- glm(y ~ x, 
                    data = base_datos, 
                    family = binomial(link = "probit"))

logit &lt;- glm(y ~ x, 
                    data = ba_datos, 
                    family = binomial(link = "logit"))
```


---
layout: false
class: clear


```r
est_logistic %&gt;% summary()
```

```
#&gt; 
#&gt; Call:
#&gt; glm(formula = i_default ~ balance, family = "binomial", data = default_df)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;     Min       1Q   Median       3Q      Max  
#&gt; -2.2697  -0.1465  -0.0589  -0.0221   3.7589  
#&gt; 
#&gt; Coefficients:
*#&gt;               Estimate Std. Error z value Pr(&gt;|z|)    
*#&gt; (Intercept) -1.065e+01  3.612e-01  -29.49   &lt;2e-16 ***
*#&gt; balance      5.499e-03  2.204e-04   24.95   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 2920.6  on 9999  degrees of freedom
#&gt; Residual deviance: 1596.5  on 9998  degrees of freedom
#&gt; AIC: 1600.5
#&gt; 
#&gt; Number of Fisher Scoring iterations: 8
```

---
layout: true
# Regresión logística

---



Es así que tenemos `\(\hat{\beta}_0 \approx -10.65\)` ademas `\(\hat{\beta}_1 \approx 0.0055\)`.

.note[Recuerde:] Esos coeficientes son los .b[log odds] no se interpretan.

--

Si deseamos .hi[tener predicciones] para `\(y_i\)` (donde puede o no caer `\(i\)` en (impago) defaults),
&lt;br&gt; debemos primero .hi[estimar dicha probabilidad] `\(\mathop{p}(\text{Balance})\)`
$$
\begin{align}
  \hat{p}(\text{Balance}) = \dfrac{e^{\hat{\beta}_0 + \hat{\beta}_1 \text{Balance}}}{1 + e^{\hat{\beta}_0 + \hat{\beta}_1 \text{Balance}}}
  \approx
  \dfrac{e^{-10.65 + 0.0055 \cdot \text{Balance}}}{1 + e^{-10.65 + 0.0055 \cdot \text{Balance}}}
\end{align}
$$

--

- Si `\(\text{Balance} = 0\)`, La estimación `\(\mathop{\hat{p}} \approx 0.000024\)`
- Si `\(\text{Balance} = 2,000\)`, La estimación es `\(\mathop{\hat{p}} \approx 0.586\)`
- Si `\(\text{Balance} = 3,000\)`, La estimación es `\(\mathop{\hat{p}} \approx 0.997\)` 


---
layout: false
class: clear, middle

Predicciones para .hi-orange[Regresión logística] `\(\mathop{p}(\text{Balance})\)`

&lt;img src="Class05_files/figure-html/plot-default-logistic-2-1.svg" style="display: block; margin: auto;" /&gt;

---
layout: true
# Regresión logistica
### Predicción

---

--

Recuerde que debemos usar a  `predict()` para obtener las predicciones de los objetos de la función `glm`.

Ahora, `predict()` produces múltiples tipos de predicciones con `type`

1. `type = "response"` Muestra .pink[dada la escala de la dependiente]
&lt;br&gt;Para la regresión logística eso significa **probabilidad del evento** va en escala de (0 a 1)

1. `type = "link"` muestra en linea .it[dada la escala de los predictores/controles]
&lt;br&gt;para regresión logística, esto significa .hi-pink[predichos los log odds] estos están entre (-∞ a ∞)

.attn[Cuidado:] el objeto de **default** es el `type = "link"`

---

Coloquemos todo junto, podemos entonces (estimar) varias probabilidades `\(\hat{p}(X)\)`


```r
# Con respecto a la variable resultado
p_hat = predict(est_logistic, type = "response")
```

Estas las usamos para los valores predichos de `\(y\)`


```r
# Una dummy para mirar si se es mayor a 0.5
y_hat = as.numeric(p_hat &gt;= 0.5)
```

---

--

.pull-left[

```
#&gt;           p_hat y_hat
#&gt; 1  1.305680e-03     0
#&gt; 2  2.112595e-03     0
#&gt; 3  8.594741e-03     0
#&gt; 4  4.344368e-04     0
#&gt; 5  1.776957e-03     0
#&gt; 6  3.704153e-03     0
#&gt; 7  2.211431e-03     0
#&gt; 8  2.016174e-03     0
#&gt; 9  1.383298e-02     0
#&gt; 10 2.366877e-05     0
```
]

--

.pull-right[

```
#&gt;              p_hat y_hat
#&gt; 9991  1.834017e-04     0
#&gt; 9992  8.853458e-04     0
#&gt; 9993  1.057664e-02     0
#&gt; 9994  4.116004e-03     0
#&gt; 9995  6.108117e-05     0
#&gt; 9996  1.182964e-03     0
#&gt; 9997  1.526339e-03     0
#&gt; 9998  2.466513e-03     0
#&gt; 9999  1.167596e-01     0
#&gt; 10000 7.144750e-05     0
```
]

---
layout: false
class: inverse, middle

# De vuelta al Titanic
&lt;img src="images/lognig.png" width="280" /&gt;

---
layout: true
# Ejemplo <svg aria-hidden="true" role="img" viewBox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:steelblue;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg>


---

--

### Limitaciones modelo de regresión lineal para dependientes dicotómicas (= modelo de probabilidad lineal) 

--



.pull-left[


&lt;img src="Class05_files/figure-html/unnamed-chunk-3-1.svg" style="display: block; margin: auto;" /&gt;
]

.pull-right[




&lt;img src="Class05_files/figure-html/unnamed-chunk-5-1.svg" style="display: block; margin: auto;" /&gt;
]

---

--

### Curvando la recta ...

.pull-left[
&lt;img src="Class05_files/figure-html/unnamed-chunk-6-1.svg" style="display: block; margin: auto;" /&gt;
]

.pull-right[



&lt;img src="Class05_files/figure-html/unnamed-chunk-8-1.svg" style="display: block; margin: auto;" /&gt;
]

---

--

### De vuelta a los Odds

--

- Los **odds** (chances): probabilidad de que algo ocurra dividido por la probabilidad de que no ocurra

`$$Odds=\frac{p}{1-p}$$`

--

.medium[
Ej. Titanic:
  - 427 sobrevivientes (41%), 619 muertos (59%)
`$$Odds_{sobrevivir}=427/619=0.41/0.59=0.69$$`

**Es decir, las chances de sobrevivir son de 0.69**]

---

--

### Ahora los Odds ratio (OR)

--

.pull-left[
- los odds-ratio (o razón de chances) permiten reflejar la asociación entre las chances de dos variables dicotómicas


**¿Tienen las mujeres más chances de sobrevivir que los hombres?**
]

--
.pull-right[
.medium[

```r
sjt.xtab(tt$survived, tt$sex,
        show.col.prc=TRUE,
        show.summary=FALSE
)
```

&lt;table style="border-collapse:collapse; border:none;"&gt;
 &lt;tr&gt;
 &lt;th style="border-top:double; text-align:center; font-style:italic; font-weight:normal; border-bottom:1px solid;" rowspan="2"&gt;survived&lt;/th&gt;
 &lt;th style="border-top:double; text-align:center; font-style:italic; font-weight:normal;" colspan="2"&gt;sex&lt;/th&gt;
 &lt;th style="border-top:double; text-align:center; font-style:italic; font-weight:normal; font-weight:bolder; font-style:italic; border-bottom:1px solid; " rowspan="2"&gt;Total&lt;/th&gt;
 &lt;/tr&gt;
 
&lt;tr&gt;
 &lt;td style="border-bottom:1px solid; text-align:center; padding:0.2cm;"&gt;Hombre&lt;/td&gt;
 &lt;td style="border-bottom:1px solid; text-align:center; padding:0.2cm;"&gt;Mujer&lt;/td&gt;
 &lt;/tr&gt;
 
&lt;tr&gt; 
&lt;td style="padding:0.2cm;  text-align:left; vertical-align:middle;"&gt;No sobrevive&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center; "&gt;&lt;span style="color:black;"&gt;523&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;79.5&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center; "&gt;&lt;span style="color:black;"&gt;96&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;24.7&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center;  "&gt;&lt;span style="color:black;"&gt;619&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;59.2&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt; 
&lt;/tr&gt;
 
&lt;tr&gt; 
&lt;td style="padding:0.2cm;  text-align:left; vertical-align:middle;"&gt;Sobrevive&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center; "&gt;&lt;span style="color:black;"&gt;135&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;20.5&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center; "&gt;&lt;span style="color:black;"&gt;292&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;75.3&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center;  "&gt;&lt;span style="color:black;"&gt;427&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;40.8&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt; 
&lt;/tr&gt;
 
&lt;tr&gt; 
&lt;td style="padding:0.2cm;  border-bottom:double; font-weight:bolder; font-style:italic; text-align:left; vertical-align:middle;"&gt;Total&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center;   border-bottom:double;"&gt;&lt;span style="color:black;"&gt;658&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;100&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center;   border-bottom:double;"&gt;&lt;span style="color:black;"&gt;388&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;100&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center;   border-bottom:double;"&gt;&lt;span style="color:black;"&gt;1046&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;100&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt; 
&lt;/tr&gt;
 
&lt;/table&gt;
]
]

---

--

### Ahora los Odds ratio (OR

--
 
**¿Cuantos más chances de sobrevivir tienen las mujeres respecto de los hombres?**

--

- OR supervivencia mujeres / OR supervivencia hombres

.medium[
`$$OR=\frac{p_{m}/(1-p_{m})}{p_{h}/(1-p_{h})}=\frac{0.753/(1-0.753)}{0.205/(1-0.205)}=\frac{3.032}{0.257}=11.78$$`
]

--

### Las chances de sobrevivir de las mujeres son **11.78** veces más que las de los hombres.


---

--

### Estimación de la Regresión logística y odds


.pull-left[
&lt;img src="Class05_files/figure-html/unnamed-chunk-10-1.svg" style="display: block; margin: auto;" /&gt;
]


.pull-right[
Una de las transformaciones que permite realizar una estimación de regresión con variables dependientes dicotómicas como lo mencionamos es el **logit**, que es logaritmo de los odds.
]

---

--

`$$Logit=ln(Odd)=ln(\frac{p}{1-p})$$`

--

.pull-left[
### Probabilidades, los odds y ademas el resultado logit

]

.pull-right[

```
#&gt;    prob
#&gt;  0.0010
#&gt;  0.0564
#&gt;  0.1119
#&gt;  0.1673
#&gt;  0.2228
#&gt;  0.2782
#&gt;  0.3337
#&gt;  0.3891
#&gt;  0.4446
#&gt;  0.5000
#&gt;  0.5554
#&gt;  0.6109
#&gt;  0.6663
#&gt;  0.7218
#&gt;  0.7772
#&gt;  0.8327
#&gt;  0.8881
#&gt;  0.9436
#&gt;  0.9990
```
]
---

`$$Logit=ln(Odd)=ln(\frac{p}{1-p})$$`

.pull-left[
### Probabilidades, los odds y ademas el resultado logit

```r
df$odds &lt;- df$prob/(1-df$prob)

df$logit &lt;- log(df$odds)
```
]

.pull-right[

```
#&gt;    prob     odds  logit
#&gt;  0.0010   0.0010 -6.907
#&gt;  0.0564   0.0598 -2.816
#&gt;  0.1119   0.1260 -2.072
#&gt;  0.1673   0.2010 -1.605
#&gt;  0.2228   0.2866 -1.250
#&gt;  0.2782   0.3855 -0.953
#&gt;  0.3337   0.5008 -0.692
#&gt;  0.3891   0.6370 -0.451
#&gt;  0.4446   0.8004 -0.223
#&gt;  0.5000   1.0000  0.000
#&gt;  0.5554   1.2494  0.223
#&gt;  0.6109   1.5700  0.451
#&gt;  0.6663   1.9970  0.692
#&gt;  0.7218   2.5942  0.953
#&gt;  0.7772   3.4888  1.250
#&gt;  0.8327   4.9761  1.605
#&gt;  0.8881   7.9374  2.072
#&gt;  0.9436  16.7165  2.816
#&gt;  0.9990 999.0000  6.907
```
]

---

--

.pull-left[

```r
modelo_titanic &lt;-
glm(survived ~ sex,
data = tt,
family = "binomial")
```
]

.pull-right[
&lt;table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;"&gt;
&lt;caption&gt; &lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;Logit&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;OR&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Intercepto&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-1.354&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.258&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.097)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Mujer (Ref=Hombre)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;2.467&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;11.784&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.152)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;AIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1106.008&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1106.008&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;BIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1115.914&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1115.914&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Log Likelihood&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-551.004&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-551.004&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Deviance&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1102.008&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1102.008&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-bottom: 2px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Num. obs.&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style="font-size: 0.8em;" colspan="3"&gt;&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.001; &lt;sup&gt;&amp;#42;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.01; &lt;sup&gt;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.05&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
]



---

--

### Interpretación

--

- Coeficiente .hi[logit] asociado a sexo (mujer) = +2.467 

- El log-odds de sobrevivencia aumenta para las mujeres en 2.467 en comparación con los hombres. 

--

### Contraste de hipótesis

- La diferencia de las probabilidades de sobrevivir entre hombres y mujeres son estadísticamente significativas, por lo que se rechaza la hipótesis nula (de ausencia de diferencias entre hombres y mujeres) con un nivel de probabilidad `\(p&lt;0.001\)`.


---

--

### Adiciones a la interpretación de los coeficientes logit

--

- Sustantivamente no nos dice mucho, ya que el **logit** es una .ul[transformación] de la escala original.

- Por lo tanto, para poder interpretar el sentido del coeficiente se requiere volver a la métrica de odds mediante una transformación inversa o **exponenciación**

---

--

### De logits a odds

--

.pull-left[
`$$logit_x=log(Odds)$$`
`$$e^{logit}=Odds_X$$`
`$$e^{2.467}=11.78$$`
]

.pull-right[

```r
exp(2.467)
```

```
#&gt; [1] 11.78703
```
### Las chances (odds) de sobrevivir siendo mujer son **11.78** veces más que las de un hombre. 
]

---

--

### De logits a odds

`$$Odds_X=e^{\beta_0 + \beta_jX_j}$$`

--

- Predicción para **mujeres**= -1.354 + (2.467 * Sexo=1) = 1.113

- Predicción para **hombres**= -1.354 + (2.467 * Sexo=0) = -1.354

--

&lt;br&gt;

`$$Odds_{mujer}=e^{1.113}=3.032$$`
`$$Odds_{hombre}=e^{-1.354}=0.257$$`

---

--

### Transformación a probabilidades predichas

`$$p_{mujeres}=\frac{e^{1.113}}{1+e^{1.113}}=\frac{3.04}{4.04}=0.752$$`
`$$p_{hombres}=\frac{e^{-1.354}}{1+e^{-1.354}}=\frac{0.258}{1.258}=0.205$$`

---

--

### Regresión logística simple para independientes continuas

--

.pull-left[

```r
modelo_titanic_age &lt;-
glm(survived ~ age,
data = tt,
family = "binomial")
```
]

.pull-right[
&lt;table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;"&gt;
&lt;caption&gt; &lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;Logit&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;OR&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Intercepto&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-0.137&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.872&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.145)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Edad&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-0.008&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.992&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.004)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;AIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1415.383&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1415.383&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;BIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1425.288&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1425.288&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Log Likelihood&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-705.691&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-705.691&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Deviance&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1411.383&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1411.383&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-bottom: 2px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Num. obs.&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style="font-size: 0.8em;" colspan="3"&gt;&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.001; &lt;sup&gt;&amp;#42;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.01; &lt;sup&gt;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.05&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
]

---

--

### Un gráfico para probabilidades predichas

&lt;img src="Class05_files/figure-html/unnamed-chunk-19-1.svg" style="display: block; margin: auto;" /&gt;


---

--

### Regresión logística multiple

--

.pull-left[

```r
modelo_titanic2 &lt;-
glm(survived ~ sex + age,
data = tt,
family = "binomial")
```
]

.pull-right[
&lt;table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;"&gt;
&lt;caption&gt; &lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;Logit&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;OR&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Intercepto&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-1.23&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.29&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.18)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Mujer (Ref=Hombre)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;2.46&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;11.71&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.15)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Edad&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-0.00&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1.00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.01)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;AIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1107.34&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1107.34&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;BIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1122.20&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1122.20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Log Likelihood&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-550.67&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-550.67&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Deviance&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1101.34&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1101.34&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-bottom: 2px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Num. obs.&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style="font-size: 0.8em;" colspan="3"&gt;&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.001; &lt;sup&gt;&amp;#42;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.01; &lt;sup&gt;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.05&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
]

---
layout: false
class: inverse, middle

# Test de ajustes
&lt;img src="images/lognig.png" width="280" /&gt;
---
layout: true

# Test

---

--

### ¿Qué tan bueno es nuestro modelo?

- **Diferente a regresión MCO** (no hay varianza en dependiente dicotomica)

--

- Para evaluar ajuste se utiliza la **log-verosimilitud** (log-likelihood), que se asocia a la idea de **residuos** del modelo

--

- La log verosimilitud del modelo se obtiene del proceso de estimación por .hi-red[máxima verosimilitud] 

---

### ¿Qué tan bueno es nuestro modelo?

--


```r
logLik(modelo_titanic) # sexo
```

```
#&gt; 'log Lik.' -551.0042 (df=2)
```

```r
logLik(modelo_titanic2) # sexo + edad
```

```
#&gt; 'log Lik.' -550.6695 (df=3)
```

La inclusión de un predictor adicional (edad) hace que cambie la log-verosimilitud del modelo

---

--

### ¿Qué tan bueno es nuestro modelo?

- No existe una **única forma** de estimar el ajuste en regresión logística

--

- El ajuste de los modelos logísticos se evalúa en general en términos **.hi-blue[comparativos]** con otros modelos 

--

- Estas medidas de comparación se basan en distintas fórmulas que consideran la **.hi[log verosimilitud (o  LL)]** y la **devianza**

---
### ¿Qué tan bueno es nuestro modelo?

--

- Entre las medidas/indicadores de ajuste usualmente se consideran:

  - Devianza

  - Test de razón de verosimilitud (likelihood ratio test)
  
  - R2s
  
  - Criterio de información de Akaike

---

--

### Devianza

- Concepto: el modelo saturado es básicamente residuos, y la devianza nos indica cuánto se han reducido los residuos a medida que se introducen parámetros al modelo. Por eso también se conoce como devianza residual.


--

- Formula: **.red[Devianza =-2*log likelihood]**


---

--

### Test de razón de verosimilitud (LRT) (...o de diferencia de devianzas)

.pull-left[
- Se comparan las devianzas de distintos modelos: si la devianza es significativamente menor, el modelo es mejor
]

.pull-right[
Obtención de devianzas

```r
-2*logLik(modelo_titanic)
```

```
#&gt; 'log Lik.' 1102.008 (df=2)
```

```r
-2*logLik(modelo_titanic2)
```

```
#&gt; 'log Lik.' 1101.339 (df=3)
```
O directamente:

```r
modelo_titanic$deviance
```

```
#&gt; [1] 1102.008
```
]

---

--

.pull-left[
### Test de razón de verosimilitud 
Comando .red[`anova`] en .red[`R`]
]


.pull-right[

```r
anova(modelo_titanic, modelo_titanic2, test ="Chisq")
```

```
#&gt; Analysis of Deviance Table
#&gt; 
#&gt; Model 1: survived ~ sex
#&gt; Model 2: survived ~ sex + age
#&gt;   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
#&gt; 1      1044     1102.0                     
#&gt; 2      1043     1101.3  1   0.6694   0.4133
```

.purple[La diferencia entre los modelos no es estadísticamente significativa con una probabilidad. Por lo tanto el modelo con dos predictores (sexo + edad) no ofrece un mejor ajuste a los datos que un modelo con solo un predictor (sexo).
]
]

---

--

.pull-left[
### Test de razón de verosimilitud 
Probemos ahora con otro modelo con la variable clase `pclass`:
- alta (ref)
- intermedia
- baja

```r
modelo_titanic3 &lt;- glm(survived ~ 
sex + pclass, 
data = tt, 
family = "binomial")
```
]

.pull-right[
&lt;table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;"&gt;
&lt;caption&gt; &lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;Logit&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;OR&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Intercepto&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-0.37&lt;sup&gt;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.69&lt;sup&gt;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.15)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Mujer (Ref=Hombre)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;2.53&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;12.53&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.16)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Clase Intermedia&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-0.90&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.41&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.21)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Clase Baja&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-1.72&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.18&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.19)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;AIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1021.80&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1021.80&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;BIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1041.61&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1041.61&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Log Likelihood&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-506.90&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-506.90&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Deviance&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1013.80&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1013.80&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-bottom: 2px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Num. obs.&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style="font-size: 0.8em;" colspan="3"&gt;&lt;sup&gt;&amp;#42;&amp;#42;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.001; &lt;sup&gt;&amp;#42;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.01; &lt;sup&gt;&amp;#42;&lt;/sup&gt;p &amp;lt; 0.05&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
]


---

--

### Test de razón de verosimilitud 


```r
anova(modelo_titanic, modelo_titanic3, test ="Chisq")
```

```
#&gt; Analysis of Deviance Table
#&gt; 
#&gt; Model 1: survived ~ sex
#&gt; Model 2: survived ~ sex + pclass
#&gt;   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
#&gt; 1      1044     1102.0                          
#&gt; 2      1042     1013.8  2   88.211 &lt; 2.2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

.purple[La diferencia entre los modelos es estadísticamente significativa con una probabilidad p &lt; 0.001. Por lo tanto el modelo con dos predictores (sexo + pclass) ofrece un mejor ajuste a los datos que un modelo con solo un predictor (sexo).]


---

--

### Test de razón de verosimilitud 

- También se puede realizar la comparación con el modelo nulo (sin predictores), que es equivalente al promedio en el caso de variables continuas
  

```r
modelo_titanic_null &lt;- glm(survived ~ 1, data = tt, family = "binomial")
anova(modelo_titanic_null, modelo_titanic3, test ="Chisq")
```

```
#&gt; Analysis of Deviance Table
#&gt; 
#&gt; Model 1: survived ~ 1
#&gt; Model 2: survived ~ sex + pclass
#&gt;   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
#&gt; 1      1045     1414.6                          
#&gt; 2      1042     1013.8  3   400.82 &lt; 2.2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---

--

###  McFadden (pseudo) R2

--

Se define como: `\(1−[LL(LM)/LL(L0)]\)`, donde
- LL es el log likelihood del modelo
- LM es el modelo posterior (con más predictores)
- L0 es el modelo nulo


```r
logLik(modelo_titanic); logLik(modelo_titanic_null)
```

```
#&gt; 'log Lik.' -551.0042 (df=2)
```

```
#&gt; 'log Lik.' -707.3102 (df=1)
```

```r
1-(-551/-707)
```

```
#&gt; [1] 0.2206506
```


---

--

###  McFadden (pseudo) R2

También se puede obtener con la función `PseudoR2` de la librería `DescTools`, junto a otras versiones de pseudo R2s, como "Nagelkerke", "CoxSnell" y "Effron".


---

--

### Akaike (AIC)

--

**AIC - Akaike information criteria**, evalua la calidad del modelo a través de la comparación con otros modelos penalizando por la inclusión de predictores (análogo al R2 ajustado):

`$$AIC=-2(log-likelihood)+2K$$`

Donde K= número de parámetros del modelo (regresores + intercepto)

A menor AIC, mejor ajuste
---

--

### Akaike (AIC)


```r
logLik(modelo_titanic)
```

```
#&gt; 'log Lik.' -551.0042 (df=2)
```

```r
2*551
```

```
#&gt; [1] 1102
```
`$$AIC=-2(-551)+2(2)=1102+4=1106$$`

---
layout: false
class: inverse
# Bibliografía

<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z"/></svg> Angrist, J. D., &amp; Pischke, J. S. (2009). *Mostly harmless econometrics: An empiricist's companion*. Princeton university press.

<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z"/></svg> Álvarez, R. A. R., Calvo, J. A. P., Torrado, C. A. M., &amp; Mondragón, J. A. U. (2013). *Fundamentos de econometría intermedia: teoría y aplicaciones*. Universidad de los Andes.

<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z"/></svg> Wooldridge, J. M. (2015). *Introductory econometrics: A modern approach*. Cengage learning.

<svg aria-hidden="true" role="img" viewBox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M384 121.941V128H256V0h6.059c6.365 0 12.47 2.529 16.971 7.029l97.941 97.941A24.005 24.005 0 0 1 384 121.941zM248 160c-13.2 0-24-10.8-24-24V0H24C10.745 0 0 10.745 0 24v464c0 13.255 10.745 24 24 24h336c13.255 0 24-10.745 24-24V160H248zM123.206 400.505a5.4 5.4 0 0 1-7.633.246l-64.866-60.812a5.4 5.4 0 0 1 0-7.879l64.866-60.812a5.4 5.4 0 0 1 7.633.246l19.579 20.885a5.4 5.4 0 0 1-.372 7.747L101.65 336l40.763 35.874a5.4 5.4 0 0 1 .372 7.747l-19.579 20.884zm51.295 50.479l-27.453-7.97a5.402 5.402 0 0 1-3.681-6.692l61.44-211.626a5.402 5.402 0 0 1 6.692-3.681l27.452 7.97a5.4 5.4 0 0 1 3.68 6.692l-61.44 211.626a5.397 5.397 0 0 1-6.69 3.681zm160.792-111.045l-64.866 60.812a5.4 5.4 0 0 1-7.633-.246l-19.58-20.885a5.4 5.4 0 0 1 .372-7.747L284.35 336l-40.763-35.874a5.4 5.4 0 0 1-.372-7.747l19.58-20.885a5.4 5.4 0 0 1 7.633-.246l64.866 60.812a5.4 5.4 0 0 1-.001 7.879z"/></svg> Rubin, E. (2021) *Econometrics Lectures class*.

<svg aria-hidden="true" role="img" viewBox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M384 121.941V128H256V0h6.059c6.365 0 12.47 2.529 16.971 7.029l97.941 97.941A24.005 24.005 0 0 1 384 121.941zM248 160c-13.2 0-24-10.8-24-24V0H24C10.745 0 0 10.745 0 24v464c0 13.255 10.745 24 24 24h336c13.255 0 24-10.745 24-24V160H248zM123.206 400.505a5.4 5.4 0 0 1-7.633.246l-64.866-60.812a5.4 5.4 0 0 1 0-7.879l64.866-60.812a5.4 5.4 0 0 1 7.633.246l19.579 20.885a5.4 5.4 0 0 1-.372 7.747L101.65 336l40.763 35.874a5.4 5.4 0 0 1 .372 7.747l-19.579 20.884zm51.295 50.479l-27.453-7.97a5.402 5.402 0 0 1-3.681-6.692l61.44-211.626a5.402 5.402 0 0 1 6.692-3.681l27.452 7.97a5.4 5.4 0 0 1 3.68 6.692l-61.44 211.626a5.397 5.397 0 0 1-6.69 3.681zm160.792-111.045l-64.866 60.812a5.4 5.4 0 0 1-7.633-.246l-19.58-20.885a5.4 5.4 0 0 1 .372-7.747L284.35 336l-40.763-35.874a5.4 5.4 0 0 1-.372-7.747l19.58-20.885a5.4 5.4 0 0 1 7.633-.246l64.866 60.812a5.4 5.4 0 0 1-.001 7.879z"/></svg> Castillo, J.C (2022) *Estadística Multivariada*.

<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z"/></svg> Oswald, F., Viers, V., Robin, J. Villedieu, P., &amp; Kenedi, G. (2020). *Introduction to Econometrics with R*. Bookdown.


---
class: middle, center
background-image: url(https://media.giphy.com/media/8VITX7wfegOSFWwnCH/giphy.gif)
background-size: cover

---
name: adios
class: middle, inverse

.pull-left[
# **¡Gracias!**
&lt;br/&gt;
## Econometría I

### Seguimos aprendiendo
]

.pull-right[
.right[
&lt;img style="border-radius: 50%;"
src="https://avatars.githubusercontent.com/u/39503983?v=4"
width="150px" /&gt;

[<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg> Syllabus/ Curso](https://carlosyanes.netlify.app/contenidoc/SyllabusEconometriaME.pdf)&lt;br/&gt;
[<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> @keynes37](https://twitter.com/keynes37)&lt;br/&gt;
[<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg> cayanes@uninorte.edu.co](mailto:cayanes@uninorte.edu.co)
]
]



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
